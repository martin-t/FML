{"Top":[{"Function":{"name":"simple_sequence","parameters":["first","last"],"body":{"Block":[{"Variable":{"name":"i","value":{"Integer":0}}},{"Variable":{"name":"n","value":{"CallMethod":{"object":{"CallMethod":{"object":{"AccessVariable":{"name":"last"}},"name":"-","arguments":[{"AccessVariable":{"name":"first"}}]}},"name":"+","arguments":[{"Integer":1}]}}}},{"Variable":{"name":"arr","value":{"Array":{"size":{"AccessVariable":{"name":"n"}},"value":"Null"}}}},{"Loop":{"condition":{"CallMethod":{"object":{"AccessVariable":{"name":"i"}},"name":"<","arguments":[{"AccessVariable":{"name":"n"}}]}},"body":{"Block":[{"AssignArray":{"array":{"AccessVariable":{"name":"arr"}},"index":{"AccessVariable":{"name":"i"}},"value":{"CallMethod":{"object":{"AccessVariable":{"name":"i"}},"name":"+","arguments":[{"AccessVariable":{"name":"first"}}]}}}},{"AssignVariable":{"name":"i","value":{"CallMethod":{"object":{"AccessVariable":{"name":"i"}},"name":"+","arguments":[{"Integer":1}]}}}}]}}},{"AccessVariable":{"name":"arr"}}]}}},{"Function":{"name":"array_iterator","parameters":["collection","size"],"body":{"Object":{"extends":"Null","members":[{"Variable":{"name":"collection","value":{"AccessVariable":{"name":"collection"}}}},{"Variable":{"name":"size","value":{"AccessVariable":{"name":"size"}}}},{"Variable":{"name":"pointer","value":{"Integer":0}}},{"Function":{"name":"reset","parameters":[],"body":{"AssignField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer","value":{"Integer":0}}}}},{"Function":{"name":"has_next","parameters":[],"body":{"CallMethod":{"object":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}},"name":"<","arguments":[{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"size"}}]}}}},{"Function":{"name":"next","parameters":[],"body":{"Block":[{"Conditional":{"condition":{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"has_next","arguments":[]}},"consequent":{"Block":[{"Variable":{"name":"next","value":{"AccessArray":{"array":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"collection"}},"index":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}}}}}},{"AssignField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer","value":{"CallMethod":{"object":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}},"name":"+","arguments":[{"Integer":1}]}}}},{"AccessVariable":{"name":"next"}}]},"alternative":"Null"}}]}}},{"Function":{"name":"for_each","parameters":["f"],"body":{"Block":[{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"reset","arguments":[]}},{"Loop":{"condition":{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"has_next","arguments":[]}},"body":{"CallMethod":{"object":{"AccessVariable":{"name":"f"}},"name":"apply","arguments":[{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}},{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"next","arguments":[]}}]}}}}]}}},{"Function":{"name":"map","parameters":["f"],"body":{"Block":[{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"reset","arguments":[]}},{"Variable":{"name":"result","value":{"Array":{"size":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"size"}},"value":"Null"}}}},{"Loop":{"condition":{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"has_next","arguments":[]}},"body":{"Block":[{"AssignArray":{"array":{"AccessVariable":{"name":"result"}},"index":{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}},"value":{"CallMethod":{"object":{"AccessVariable":{"name":"f"}},"name":"apply","arguments":[{"AccessField":{"object":{"AccessVariable":{"name":"this"}},"field":"pointer"}},{"CallMethod":{"object":{"AccessVariable":{"name":"this"}},"name":"next","arguments":[]}}]}}}}]}}},{"AccessVariable":{"name":"result"}}]}}}]}}}},{"Variable":{"name":"print_lambda","value":{"Object":{"extends":"Null","members":[{"Function":{"name":"apply","parameters":["index","value"],"body":{"Print":{"format":"~: ~\\n","arguments":[{"AccessVariable":{"name":"index"}},{"AccessVariable":{"name":"value"}}]}}}}]}}}},{"Variable":{"name":"increment_lambda","value":{"Object":{"extends":"Null","members":[{"Function":{"name":"apply","parameters":["index","value"],"body":{"CallMethod":{"object":{"AccessVariable":{"name":"value"}},"name":"+","arguments":[{"Integer":1}]}}}}]}}}},{"Variable":{"name":"collection_length","value":{"Integer":10}}},{"Variable":{"name":"collection","value":{"CallFunction":{"name":"simple_sequence","arguments":[{"Integer":10},{"CallMethod":{"object":{"CallMethod":{"object":{"Integer":10},"name":"+","arguments":[{"AccessVariable":{"name":"collection_length"}}]}},"name":"-","arguments":[{"Integer":1}]}}]}}}},{"Print":{"format":"collection: ~\\n","arguments":[{"AccessVariable":{"name":"collection"}}]}},{"Variable":{"name":"iterator","value":{"CallFunction":{"name":"array_iterator","arguments":[{"AccessVariable":{"name":"collection"}},{"AccessVariable":{"name":"collection_length"}}]}}}},{"Loop":{"condition":{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"has_next","arguments":[]}},"body":{"Print":{"format":"gimme more: ~\\n","arguments":[{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"next","arguments":[]}}]}}}},{"Print":{"format":"gimme too much: ~\\n","arguments":[{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"next","arguments":[]}}]}},{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"reset","arguments":[]}},{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"for_each","arguments":[{"AccessVariable":{"name":"print_lambda"}}]}},{"Variable":{"name":"incremented_collection","value":{"CallMethod":{"object":{"AccessVariable":{"name":"iterator"}},"name":"map","arguments":[{"AccessVariable":{"name":"increment_lambda"}}]}}}},{"Print":{"format":"incremented collection: ~\\n","arguments":[{"AccessVariable":{"name":"incremented_collection"}}]}}]}
